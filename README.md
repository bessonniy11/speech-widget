# Speech Widget

Небольшой виджет для Windows, который позволяет диктовать текст голосом.

## Функционал

* Распознавание речи при удержании горячей клавиши (по умолчанию `Ctrl+Space`).
* Вставка распознанного текста после отпускания клавиш.
* Визуализация уровня громкости голоса в виде анимированных столбиков на виджете.
* Возможность перемещения виджета по экрану.
* Настройки:
  * Изменение горячей клавиши активации.
  * Включение/отключение автозапуска при старте Windows.
* Иконка в системном трее для доступа к настройкам и выходу.

## Установка зависимостей

Для работы скрипта и сборки приложения необходимы следующие библиотеки Python:

```bash
pip install vosk sounddevice pynput pyperclip Pillow PySide6 pywin32
```

* `vosk`: Для распознавания речи (требует скачивания языковой модели).
* `sounddevice`: Для захвата звука с микрофона.
* `pynput`: Для отслеживания нажатий клавиш (глобальный хук).
* `pyperclip`: Для копирования текста в буфер обмена.
* `Pillow`: Для работы с изображениями (хотя в текущей версии может быть не нужна).
* `PySide6`: Для создания графического интерфейса (виджет, окно настроек, трей).
* `pywin32`: Для взаимодействия с Windows API (работа с реестром для автозапуска).

Также необходима **языковая модель Vosk**. Скачайте подходящую модель (например, небольшую русскую модель `vosk-model-small-ru-0.22`) с [официального сайта Vosk](https://alphacephei.com/vosk/models) и распакуйте содержимое архива в папку `model` в корне проекта.

## Сборка приложения (.exe)

Для сборки исполняемого файла `.exe` используется Nuitka.

1. **Установите Nuitka:**

   ```bash
   pip install nuitka
   ```
2. **Установите компилятор C++:** Nuitka требует наличия компилятора C++. Проще всего установить Visual Studio Community (бесплатная версия) с компонентом "Разработка классических приложений на C++". Убедитесь, что компилятор (cl.exe) доступен в системной переменной PATH, или запускайте сборку из "Developer Command Prompt for VS".
3. **Запустите скрипт сборки:**

   ```bash
   .\build_onefile.bat
   ```

   Скрипт автоматически удалит предыдущую папку сборки (`nuitka_dist_onefile`), затем соберет приложение в один `.exe` файл со всеми зависимостями, моделью Vosk и ресурсами (иконками). Готовый файл `Speech Widget.exe` будет находиться в папке `nuitka_dist_onefile`.

## Управление версией

Версия приложения задается **только** в одном месте: в файле `speech_widget.py` в константе `__version__`.

```python
# speech_widget.py
# ...
__version__ = "1.0.0" # Измените здесь для новой версии
# ...
```

Эта версия отображается в заголовке окна настроек. При сборке Nuitka не использует эту версию для метаданных файла `.exe`, так как параметр `--file-version` был убран из `build_onefile.bat` для централизации.

## Запуск для разработки

```bash
python speech_widget.py
```

*Примечание:* Для корректной работы глобального перехвата клавиш и вставки текста может потребоваться запуск скрипта от имени администратора.

## Подготовка

* Убедитесь, что папка `model` с распакованной моделью Vosk находится в корне проекта.
* Поместите иконку приложения в формате `.ico` (например, `icon.ico`) в папку `assets`. SVG-иконку (`icon.svg`) можно использовать для трея, но для `.exe` нужен `.ico`. Для конвертации можно использовать онлайн-сервисы или графические редакторы.

## Запуск для разработки

Запускать из терминала, открытого **от имени администратора** (для перехвата клавиш и вставки):

```bash
python speech_widget.py
```

## Сборка .exe с помощью Nuitka

**Необходимо:**

* Установленный Nuitka (`pip install nuitka`)
* Установленный компилятор C++ (например, из Visual Studio Community с компонентом "Разработка классических приложений на C++")

**2. Сборка в один .exe файл**
